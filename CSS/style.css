:root{
  --bg-primary:#F7F6F3; --surface-1:#FFFFFF; --surface-2:#F1F2F4;
  --brand-deep-blue:#0B3D91; --brand-amber:#FFB347;
  --text-primary:#1A1D21; --text-secondary:#5B6673; --text-inverse:#FFFFFF;
  --accent-mint:#3FD0C9; --accent-lavender:#8E94F2;
  --line-soft:#E5E7EB; --line-hard:#CBD5E1;
  --success:#1DB954;

  --font: system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;

  --h1-size:32px; --h1-line:40px; --h2-size:24px; --h2-line:32px;
  --body-size:16px; --body-line:24px; --label-size:14px; --label-line:20px; --caption-size:12px; --caption-line:16px;

  --s8:8px; --s12:12px; --s16:16px; --s20:20px; --s24:24px; --s32:32px;
  --r-m:12px; --r-l:16px; --r-xl:24px;
  --shadow-soft:0 4px 12px rgba(16,24,40,.10);
  --shadow-elevated:0 8px 24px rgba(16,24,40,.18);

  --safe:32px; --header-h:88px; --footer-h:88px;
}

/* Base */
*{ box-sizing:border-box }
html,body{ height:100%; background:var(--bg-primary); color:var(--text-primary); font-family:var(--font) }
body{ margin:0 }
h1,h2,h3,p{ margin:0 }
a{ color:var(--brand-deep-blue); text-decoration:underline }

.h1{ font-size:var(--h1-size); line-height:var(--h1-line); font-weight:700 }
.h2{ font-size:var(--h2-size); line-height:var(--h2-line); font-weight:600 }
.body{ font-size:var(--body-size); line-height:var(--body-line) }
.label{ font-size:var(--label-size); line-height:var(--label-line); color:var(--text-secondary) }
.caption{ font-size:var(--caption-size); line-height:var(--caption-line); color:var(--text-secondary) }

/* App Frame */
.app{ min-height:100dvh; max-width:1024px; margin:0 auto; padding:var(--safe);
  display:grid; grid-template-rows:auto auto 1fr auto; gap:var(--s16) }

.org-header{ position:sticky; top:0; height:var(--header-h); z-index:30;
  background:var(--bg-primary); display:flex; align-items:center; justify-content:space-between; gap:12px }
.header-actions{ display:flex; gap:var(--s8); align-items:center }
.fab-accessibility{ background:var(--surface-1); border:1px solid var(--line-soft); border-radius:999px;
  padding:8px 12px; box-shadow:var(--shadow-soft); cursor:pointer }

/* Brand title in header */
.brand-title{ display:flex; flex-direction:column; line-height:1.15 }
.brand-main{ font-size:22px; font-weight:800; letter-spacing:.02em }
.brand-sub{ font-size:12px; color:var(--text-secondary) }

/* Language dropdown */
.lang-wrap{ position:relative }
.lang-menu{
  position:absolute; right:0; top:calc(100% + 6px);
  min-width:200px; background:var(--surface-1); border:1px solid var(--line-soft); border-radius:12px;
  box-shadow:var(--shadow-elevated); padding:6px; list-style:none; margin:0; z-index:50;
}
.lang-menu li{
  padding:10px 12px; border-radius:10px; cursor:pointer;
}
.lang-menu li[aria-selected="true"]{
  background:var(--surface-2); font-weight:600;
}
.lang-menu li:hover{ background:#f6f7f9 }

/* Progress */
.progress{ position:relative; z-index:1; pointer-events:none }
.progress ol{ margin:0; padding:0; list-style:none; display:flex; gap:var(--s8); align-items:center }
.progress ol li{ width:16px; height:16px; border-radius:50%; border:2px solid var(--line-hard) }
.progress ol li.is-active{ background:var(--brand-amber); border-color:var(--brand-amber) }
.progress ol li.is-done{ background:var(--brand-deep-blue); border-color:var(--brand-deep-blue) }
.progress.small ol li{ width:10px; height:10px }

.content{ padding-top:6px; padding-bottom:calc(var(--footer-h) + 24px);
  position:relative; z-index:0; display:grid; grid-template-columns:1fr; align-content:start }

/* Footer */
.org-footer{ position:sticky; bottom:0; height:var(--footer-h); z-index:30;
  background:var(--bg-primary); display:flex; align-items:center; justify-content:space-between; gap:var(--s16) }
#btn-back.is-hidden, #btn-next.is-hidden{ visibility:hidden; pointer-events:none }

/* Primitives */
.card{ background:var(--surface-1); border:1px solid var(--line-soft); border-radius:var(--r-l);
  padding:var(--s24); box-shadow:var(--shadow-soft) }
.placeholder{ background:var(--surface-2); border:1px dashed var(--line-hard); border-radius:var(--r-m);
  min-height:120px; display:grid; place-items:center; color:var(--text-secondary); pointer-events:none }

.stack{ display:flex; flex-direction:column }
.row-between{ display:flex; align-items:center; justify-content:space-between; gap:12px }
.center{ align-items:center; text-align:center }
.actions-row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }

/* Responsive grids */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:var(--s24) }
@media (max-width:860px){ .grid-2{ grid-template-columns:1fr } }

.grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:var(--s24) }
@media (max-width:1024px){ .grid-3{ grid-template-columns:1fr 1fr } }
@media (max-width:720px){ .grid-3{ grid-template-columns:1fr } }

/* Buttons & Chips */
.btn{ appearance:none; border:0; border-radius:var(--r-l); padding:14px 18px; font-size:16px; cursor:pointer;
  position:relative; z-index:1; pointer-events:auto; transition: transform .14s ease, box-shadow .14s ease }
.btn-primary{ background:var(--brand-deep-blue); color:var(--text-inverse) }
.btn-secondary{ background:var(--surface-2); color:var(--text-primary); border:1px solid var(--line-hard) }
.btn-ghost{ background:transparent; color:var(--text-primary); border:1px solid var(--line-soft) }
.btn:disabled{ opacity:.5; cursor:not-allowed }
.btn-start{ padding:16px 24px; font-weight:700 }
.btn-analyze{ display:inline-flex; align-items:center; gap:8px }
.spin-dot{ width:10px; height:10px; border-radius:50%; background:transparent; box-shadow:none; transition:all .2s }
.btn-analyzing .spin-dot{ background:var(--text-inverse); animation: blink 1s ease-in-out infinite }
@keyframes blink{ 0%{opacity:.2;transform:scale(.8)} 50%{opacity:1;transform:scale(1)} 100%{opacity:.2;transform:scale(.8)} }

/* Start hero */
.logo-hero{ width:120px; height:auto; display:block; margin:0 auto 8px; }

/* Voice input */
.notice{ padding:10px 12px; border-radius:10px; border:1px solid var(--line-hard); background:#fff9e8; color:#7a5a00 }
.is-hidden{ display:none !important; }
.voice-list{ display:flex; flex-direction:column; gap:10px }
.voice-row{ display:grid; grid-template-columns: 24px 1fr auto auto; gap:8px; align-items:center }
.voice-out{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line-hard); background:#fff }
.mic,.done{ white-space:nowrap }

/* Pen input */
#pen-canvas{ border:1px solid var(--line-hard); border-radius:var(--r-m); background:#fff; cursor:crosshair }

/* Search input (large) */
.search-lg input[type="search"]{
  width:100%; padding:16px 18px; font-size:16px; border-radius:14px; border:1px solid var(--line-hard); background:#fff
}

/* Chips / Pills */
.chips{ display:flex; gap:var(--s12); flex-wrap:wrap }
.chip{ padding:10px 14px; border-radius:999px; border:1px solid var(--line-soft); background:var(--surface-1);
  cursor:pointer; position:relative; transition:box-shadow .15s, border-color .15s }
.chip.is-selected{ border-color:var(--brand-deep-blue); box-shadow:0 0 0 3px rgba(11,61,145,.15) }

.pill{ display:inline-flex; align-items:center; gap:8px; background:var(--surface-2); border:1px solid var(--line-hard);
  border-radius:999px; padding:6px 10px; margin:6px 8px 0 0 }
.pill button{ border:0; background:transparent; cursor:pointer }

/* Toggle cards */
.toggle-card .toggle-head{ display:flex; align-items:baseline; justify-content:space-between; gap:8px; margin-bottom:10px }
.toggle-list{ display:flex; flex-direction:column; gap:10px }
.switch{ display:flex; align-items:center; gap:10px; cursor:pointer }
.switch input{ inline-size:20px; block-size:20px }

/* Summary rows */
.summary{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:12px }
.summary-row{
  display:grid; grid-template-columns: 140px 1fr 96px; align-items:center; gap:12px;
  background:var(--surface-1); border:1px solid var(--line-soft); border-radius:var(--r-m); padding:12px 14px;
}
.summary-key{ font-weight:600; color:var(--text-primary) }
.summary-val{ color:var(--text-secondary); min-height:24px; display:flex; align-items:center }
.btn-edit{
  justify-self:end; min-width:96px; height:40px; padding:0 12px;
  border:1px solid var(--line-soft); background:#fff; color:var(--text-primary);
  border-radius:12px; box-shadow:var(--shadow-soft);
  transition: box-shadow .15s ease, transform .12s ease, background .15s ease;
}
.btn-edit:hover{ box-shadow:0 8px 20px rgba(16,24,40,.12); background:#fdfdfd; transform:translateY(-1px) }
.btn-edit:active{ transform:translateY(0) }
@media (max-width:720px){ .summary-row{ grid-template-columns: 110px 1fr 88px } }
@media (max-width:520px){ .summary-row{ grid-template-columns: 1fr; row-gap:8px; align-items:start } .btn-edit{ justify-self:start } }

/* Recommendations */
.reco-grid{ display:grid; grid-template-columns:1fr; gap:var(--s24) }
.reco.card{ display:flex; flex-direction:column; gap:12px; align-items:stretch }
.visual{
  width:100%; aspect-ratio:1/1; background:var(--surface-2); border:1px solid var(--line-hard);
  border-radius:var(--r-m); overflow:hidden; display:grid; place-items:center;
}
.analysis-img{ width:100%; height:100%; object-fit:contain; display:block }
.reco-eq{ min-height:420px }
.btn-order{
  background: var(--brand-deep-blue); color: var(--text-inverse); border: 1px solid transparent;
  box-shadow: var(--shadow-soft); transform: translateZ(0);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, filter .18s ease;
}
@media (hover:hover){
  .btn-order:hover{ background:#124ebd; box-shadow:0 10px 24px rgba(16,24,40,.18); transform:translateY(-2px); filter:saturate(1.1) }
}
.btn-order:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(11,61,145,.25), var(--shadow-soft) }

/* Order meta (3 columns) */
.order .order-meta{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-bottom:16px }
.meta{ background:#fff; border:1px solid var(--line-soft); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:4px }
.meta-label{ font-size:12px; color:var(--text-secondary) }
.meta-val{ font-size:20px; letter-spacing:.04em }
.meta-sub{ font-size:12px; color:var(--text-secondary) }
.live-chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#eef6ff; border:1px solid #cfe3ff; color:#194b9b }

/* Custom radio cards */
.custom-block{ border-top:1px dashed var(--line-hard); padding-top:16px; margin-top:8px }
.radio-cards{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px }
@media (max-width:820px){ .radio-cards{ grid-template-columns:1fr } }
.radio-card{
  display:flex; flex-direction:column; gap:6px; padding:14px; border:2px solid var(--line-soft);
  border-radius:16px; cursor:pointer; user-select:none; transition:border-color .15s ease, box-shadow .15s ease, transform .1s ease
}
.radio-card:hover{ transform:translateY(-1px); box-shadow:var(--shadow-soft) }
.radio-card input{ display:none }
.radio-card .radio-title{ font-weight:700 }
.radio-card .radio-desc{ font-size:14px; color:var(--text-secondary) }
.radio-card.is-active{ border-color:var(--brand-deep-blue); box-shadow:0 0 0 4px rgba(11,61,145,.10) }
.current-choice{ margin-top:8px; font-weight:600 }

/* Template steps */
.tpl-step{ display:none }
.tpl-step[data-active]{ display:block }

/* Accessibility Focus outlines */
:focus-visible{ outline: 3px solid rgba(11,61,145,.35); outline-offset:2px }
